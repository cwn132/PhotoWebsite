<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!--<title th:if="not ${ #strings.isEmpty(user)}" th:text="${user}+摄影作品展示" >-->
    <!--<a th:if="${ #strings.isEmpty(user)}">摄影作品展示</a>-->
    <link rel="icon" type="images/img_4.jpg" href="favicon.ico"/>
    <title th:if="not ${ #strings.isEmpty(loginUser)}" th:text="${loginUser}+用户中心">
    </title>
    <!--<a  th:if="not ${ #strings.isEmpty(user)}" th:text="${user}+摄影作品展示"></a>-->


    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Free HTML5 Website Template by ProBootstrap.com" />
    <meta name="keywords" content="free bootstrap 4, free bootstrap 4 template, free website templates, free html5, free template, free website template, html5, css3, mobile first, responsive" />
    <meta name="author" content="ProBootstrap.com" />

    <link href="https://fonts.googleapis.com/css?family=Work+Sans" rel="stylesheet">

    <link rel="stylesheet" th:href="@{css/bootstrap.min.css}" >
    <link rel="stylesheet" th:href="@{css/open-iconic-bootstrap.min.css}">

    <link rel="stylesheet" th:href="@{css/owl.carousel.min.css}"  >
    <link rel="stylesheet" th:href="@{css/owl.theme.default.min.css}" >

    <link rel="stylesheet" th:href="@{css/icomoon.css}"  >
    <link rel="stylesheet" th:href="@{css/animate.css}" >
    <link rel="stylesheet" th:href="@{css/style.css}"  >

</head>
<style type="text/css">
    *{margin:0;padding:0;}
    .alldom{width:100%;height:100%;}
    dl{padding:0;list-style:none;}
    dl dt{overflow:hidden;width:100px;height:115px;float:left;margin-left:55px;background:url(file/images/213125.png) center top no-repeat;border:1px solid #fff;position:relative;transition:all 0.2s ease-in 0.1s;}
    dl dt.bgclocrc{background:url(file/images/213125.png) center top no-repeat #f1f2fd;border:1px solid #a7aae3;}
    dl dt:hover{background:url(file/images/213125.png) center top no-repeat #f1f2fd;border:1px solid #a7aae3;}
    input.changename{position:absolute;border-radius:0px;left:-25px;bottom:10px;overflow:hidden;width:98px;height:20px;color:#595c5f;line-height:20px;text-align:center;font-size:12px;z-index:0;border:none;}
    input.changename:hover{background:none;color: #0824ff;}
    input{width:88px;height:24px;line-height:20px;text-align:center;background:none;border:1px solid #CCC;border-radius:8px;transition:all 0.2s ease-in 0.1s;margin-left:25px;}
    input:hover{background:#09F;color:#fff;}
    .menu-zdy{width:120px;padding:4px;height:auto;background:#f8f8f8;border:1px solid #999;text-align:center;position:absolute;display:none;}
    .menu-zdy a{text-decoration:none;text-align:center;line-height:24px;font-family:'Microsoft YaHei';font-size:12px;color:#666;transition:all 0.2s ease-in 0.1s;}
    .menu-zdy .menu-one{padding:5px;width:100px;height:24px;border-bottom:1px dashed #FC0;}
    .menu-zdy .menu-two{padding:5px;width:100px;height:24px;border-bottom:1px dashed #FC0;}
    .menu-zdy a:hover{padding:3px 5px;color:#000;background:#fff;}
</style>

<body>

<aside class="probootstrap-aside js-probootstrap-aside">
    <a href="#" class="probootstrap-close-menu js-probootstrap-close-menu d-md-none"><span class="oi oi-arrow-left"></span> Close</a>
    <div class="probootstrap-site-logo probootstrap-animate" data-animate-effect="fadeInLeft">
        <a th:href="@{/changeheadimg(pp=${loginUser},l='zh_CH')}">
            <img th:src="${headimg}" class="round_icon"  th:alt="${loginUser}"  >
        </a>
        <p class="mb-1"><a th:text="Welcome+' '+${loginUser}" th:if="${not #strings.isEmpty(loginUser)}" th:href="@{/accountmain(pp=${loginUser},l='zh_CH')}"></a></p>
        <br>
        <p class="mb-1"><a th:text="${usersigninfo}" th:if="${not #strings.isEmpty(usersigninfo)}"></a></p>
        </p>
        <br>

        <!--<a href="index.html" class="mb-2 d-block probootstrap-logo">Aside</a>-->
        <p class="mb-1"><a th:if="${#strings.isEmpty(loginUser)}" th:href="@{/accountmain.html(l='en_US')}">English</a>
            <a th:if="${ #strings.isEmpty(loginUser)}" th:href="@{/accountmain.html(l='zh_CH')}">中文</a></p>

        <p class="mb-1"><a th:if="${not #strings.isEmpty(loginUser)}" th:href="@{/accountmain(pp=${loginUser},l='en_US')}">English</a>
            <a  th:if="${not #strings.isEmpty(loginUser)}" th:href="@{/accountmain(pp=${loginUser},l='zh_CH')}">中文</a></p>



    </div>
    <div class="probootstrap-overflow">
        <nav class="probootstrap-nav">
            <ul>

                <li class="probootstrap-animate active" data-animate-effect="fadeInLeft"><a th:text="#{index.personalInfo}" th:href="@{/accountmain(pp=${loginUser},l='zh_CH')}">PersonalInfo</a></li>
                <li class="probootstrap-animate " data-animate-effect="fadeInLeft"><a th:text="#{index.photoInfo}" th:href="@{/file(pp=${loginUser},l='zh_CH')}">PhotoInfo</a></li>
                <li class="probootstrap-animate " data-animate-effect="fadeInLeft"><a th:text="#{index.shareInfo}" th:href="@{/index(pp=${loginUser},l='zh_CH')}">ShareInfo</a></li>
                <li class="probootstrap-animate " data-animate-effect="fadeInLeft"><a th:text="#{index.messageInfo}" th:href="@{/index(pp=${loginUser},l='zh_CH')}">MessageInfo</a></li>
                <li class="probootstrap-animate " data-animate-effect="fadeInLeft"><a th:text="#{index.changepassword}" th:href="@{/index(pp=${loginUser},l='zh_CH')}">ChangePassword</a></li>
                <li class="probootstrap-animate " data-animate-effect="fadeInLeft"><a th:text="#{index.logout}" th:href="@{/logout}">Logout</a></li>

            </ul>
        </nav>
        <footer class="probootstrap-aside-footer probootstrap-animate" data-animate-effect="fadeInLeft">
            <!--<ul class="list-unstyled d-flex probootstrap-aside-social">-->
            <!--<li><a href="#" class="p-2"><span class="icon-twitter"></span></a></li>-->
            <!--<li><a href="#" class="p-2"><span class="icon-instagram"></span></a></li>-->
            <!--<li><a href="#" class="p-2"><span class="icon-dribbble"></span></a></li>-->
            <!--</ul>-->
            <!--<p>&copy; 2019 ProBootstrap:Aside. <br> All Rights Reserved</p>-->
        </footer>
    </div>
</aside>


<main role="main" class="probootstrap-main js-probootstrap-main">
    <div class="probootstrap-bar">
        <a href="#" class="probootstrap-toggle js-probootstrap-toggle"><span class="oi oi-menu"></span></a>
        <div class="probootstrap-main-site-logo">
        </div>
    </div>


    <!--<div class="card-columns">-->

    <!--</div>-->
    <br>


    <div class="container-fluid">

        <!--<link rel="import" th:href="@{/filemanage.html}" />-->


        <p style=" margin:10px auto; padding:10px 0; border-bottom:1px solid #666;"><input type="submit" value="创建新文件夹" class="carrynews"/>
            <!--<input type="submit" value="清空文件夹" class="removeall"/>-->
            <input type="submit" value="删除文件夹" class="remove" id="removebutton"/></p>
        <br/>


        <div  class="alldom">
            <input type="hidden" id="userid" name="userid" th:value="${userid}"/>
            <input type="hidden" id="loginUser" name="loginUser" th:value="${loginUser}"/>
            <dl id="divall"  >

                <dt th:each="entries,stat:${documentfile}">

                    <input type="text" name="changename" class="changename" th:value="${entries['DOCUMENTFILENAME']}" />
                    <input type="hidden"   name="documentfileid" class="documentfileid"  th:value="${entries['DOCUMENTFILEID']}"/>

                    <!--<p  hidden class="p2" id="p2"  name="p2" th:text="${entries['DOCUMENTFILENAME']}"></p>-->
                    <a  th:href="@{/gallery(pp=${loginUser},documentfileid=${entries['DOCUMENTFILEID']},l='zh_CH')}"  style="text-align: right">
                        <p class="p2" th:text="${entries['IMGNUM']}"></p>
                    </a>

                </dt>

                <!--<dt><input type="text" class="changename" value="我的文件夹一"/></dt>-->
                <!--<dt><input type="text" class="changename" value="我的文件夹二"/></dt>-->
                <!--<dt><input type="text" class="changename" value="我的文件夹三"/></dt>-->
            </dl>
        </div>

        <div style=" clear:both;"></div>

        <div class="menu-zdy" id="menu">

            <div class="menu-one">
                <a href="#nogo" id="changename">修改文件夹名称</a>
            </div>

            <div class="menu-two">
                <a href="#nogo" id="removethispc">删除此文件</a>
            </div>

        </div>

        <!--<div style="text-align:center;clear:both;">-->
            <!--<script src="/gg_bd_ad_720x90.js" type="text/javascript"></script>-->
            <!--<script src="/follow.js" type="text/javascript"></script>-->
        <!--</div>-->



    </div>

</main>



<script src="js/jquery-3.2.1.slim.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/imagesloaded.pkgd.min.js"></script>
<script src="js/imagesloaded.pkgd.min.js"></script>

<script src="js/main.js"></script>


<script type="text/javascript" src="file/js/menu.js"></script>

<script type="text/javascript" src="file/js/jquery-1.8.8.js"></script>
<script> var jq18 = $.noConflict(true); </script>

<script type="text/javascript">


    // function enImg(loginUser){
    //     window.location.href = '/index?pp='+loginUser+'&l=zh_CH';
    // }

    //
    jq18(function($){

        var loginUser=document.getElementById("loginUser").value; //获取session
        var userid=document.getElementById("userid").value;
        var oldfilename;
        var documentfileid;


        var $parent = $('#divall'),$bgcolor = $('#divall dt'),$carry = $('.carrynews'),
            $removenews = $('.remove'),$removeall = $('.removeall'),$removeright = $('#removethispc'),
            $namehide = $('#divall dt input.changename'), $idhide = $('#divall dt p.p1'),$getidbybgcolor = $('#divall dt input'),
            $changename = $('#changename');

        $removenews.hide();

        //新建
        $carry.live('click' , function(){
            alert('确定新建文件夹？')
            setTimeout(
                function(){

                    // var loginUser=document.getElementById("loginUser").value;
                    // var documentfileid=document.getElementById("documentfileid").value;

                    // $parent.append("<dt><input type='text' \class='changename'\ value='新建文件夹'/></dt>");

                    /**************新建文件夹****************/
                    $.ajax({
                        url: "/adddocumentfile",
                        type: 'post',
                        async : false,
                        cache : false,
                        data: "userid="+userid,
                        dataType: "json",
                        error: function(result){
                            alert('错误信息，请与系统管理员联系！');
                        },
                        success: function(result){

                            window.location.href = '/file?pp='+loginUser+'&l=zh_CH';

                        },beforeSend: function(){

                        },
                        complete: function(){

                        }

                    });
                    /******************************/


                },500);
        });
        //清空
        $removeall.live('click' , function(){
            alert('确定清空所有文件夹？')
            setTimeout(
                function(){
                    $parent.empty();

                },500);
        }); //新文件夹不起作用！！

        //变色
        $bgcolor.live('click' , function(){

            var btns = document.getElementById('removebutton');
            btns02 = document.getElementById('removethispc');
            $removenews.fadeIn(250);
            $(this).addClass('bgclocrc').siblings().removeClass('bgclocrc');
            $(this).attr("id",'remove').siblings().attr('id','');
            $( " input[type=text] ").attr("id",'namecc').siblings().attr('id',' ');

            documentfileid=$('#remove').find('.documentfileid').val();
            //alert($('#remove').find('.documentfileid').val());
            // alert($("input[name='df']").get(2).value);

            //删除文件夹
            btns.onclick = function(){//js 调用
                 // var documentfileid=document.getElementById("documentfileid").value;

                alert('确定删除文件夹？');
                setTimeout(
                    function(){


                        if($bgcolor.hasClass('bgclocrc'))
                        {
                            // alert($changename.val());
                            var  dfid=$('#remove').find('.documentfileid').val();

                                    $('#remove').remove();//jq
                                    $removenews.fadeOut(250);

                            /**************删除文件夹****************/
                            $.ajax({
                                url: "/deldocumentfile",
                                type: 'post',
                                async : false,
                                cache : false,
                                data: "documentfileid="+dfid,
                                dataType: "json",
                                error: function(result){
                                    alert('错误信息，请与系统管理员联系！');
                                },
                                success: function(result){

                                    $('#remove').remove();//jq
                                    $removenews.fadeOut(250);
                                    window.location.href = '/file?pp='+loginUser+'&l=zh_CH';

                                },beforeSend: function(){

                                },
                                complete: function(){

                                }

                            });
                            /******************************/


                        }else
                        {
                            alert('请选择文件')
                        }
                    },250)
            }

            btns02.onclick = function(){//js 调用
                alert('确定删除文件夹？');
                setTimeout(
                    function(){
                        if($bgcolor.hasClass('bgclocrc'))
                        {
                            $('#remove').remove();//jq
                            $removenews.fadeOut(250);
                        }else
                        {
                            alert('请选择文件')
                        }
                    },250)
            }//	右键功能---删除

            //右键菜单
            var container = document.getElementById('remove');
            var menu = document.getElementById('menu');

            /*显示菜单*/
            function showMenu() {

                var evt = window.event || arguments[0];

                /*获取当前鼠标右键按下后的位置，据此定义菜单显示的位置*/
                var rightedge = container.clientWidth-evt.clientX;
                var bottomedge = container.clientHeight-evt.clientY;

                /*如果从鼠标位置到容器右边的空间小于菜单的宽度，就定位菜单的左坐标（Left）为当前鼠标位置向左一个菜单宽度*/
                if (rightedge < menu.offsetWidth)
                    menu.style.left = container.scrollLeft + evt.clientX - menu.offsetWidth + "px";
                else
                /*否则，就定位菜单的左坐标为当前鼠标位置*/
                    menu.style.left = container.scrollLeft + evt.clientX + "px";

                /*如果从鼠标位置到容器下边的空间小于菜单的高度，就定位菜单的上坐标（Top）为当前鼠标位置向上一个菜单高度*/
                if (bottomedge < menu.offsetHeight)
                    menu.style.top = container.scrollTop + evt.clientY - menu.offsetHeight + "px";
                else
                /*否则，就定位菜单的上坐标为当前鼠标位置*/
                    menu.style.top = container.scrollTop + evt.clientY + "px";

                /*设置菜单可见*/
                menu.style.display = "block";
                LTEvent.addListener(menu,"contextmenu",LTEvent.cancelBubble);
            }
            /*隐藏菜单*/
            function hideMenu() {
                menu.style.display = 'none';
            }
            LTEvent.addListener(container,"contextmenu",LTEvent.cancelBubble);
            LTEvent.addListener(container,"contextmenu",showMenu);
            LTEvent.addListener(document,"click",hideMenu);

            //
            $changename.live('click' , function(){
                if($bgcolor.hasClass('bgclocrc'))
                {
                    $('#remove').find('.changename').val('');
                    $('#remove').find('.changename').css('border','1px solid #FF0000')
                }else
                {

                    alert('请选择文件')
                }
                // window.location.href = '/index?pp=cwn&l=zh_CH';
            });
        });



        // //获取文件夹ID
        // $getidbybgcolor.live('click' , function(){
        //         alert($("input[name='df']").attr('class'));
        // });


        //修改文件名
        $namehide.live('focus' , function(){

            oldfilename=$(this).val();
            $(this).css('border','1px solid #FF0000');
            $(this).val('');
        });


        $namehide.live('blur' , function(){

            var newfilename= $(this).val();
            $(this).css('border','none');

            // alert(documentfileid);
            if( $(this).val() == ""){
                // alert("不能为空，请输入文件夹名称!");
                $(this).val(oldfilename);

            }else{

                /**************删除文件夹****************/
                $.ajax({
                    url: "/updatedocumentfile",
                    type: 'post',
                    async : false,
                    cache : false,
                    data: {"documentfileid":documentfileid,"newfilename":newfilename},
                    dataType: "json",
                    error: function(result){
                        alert('错误信息，请与系统管理员联系！');
                    },
                    success: function(result){

                        window.location.href = '/file?pp='+loginUser+'&l=zh_CH';

                    },beforeSend: function(){

                    },
                    complete: function(){

                    }

                });
                /******************************/

            }

        });

        // $("dl dt").click(function() {
        //     //  // var documentfileid=document.getElementById("documentfileid").value;
        //     // var a = $(".p1").html();
        //     // // var a = $ (this).find ("p").text ();  // 找到当前点击的dt下的a标签并获取其内容
        //     //  alert(a);
        //     // $(this).addClass('bgclocrc').siblings().removeClass('bgclocrc');
        // });

    });

</script>


</body>
</html>